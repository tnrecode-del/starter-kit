# Развертывание и реализация Full-Stack Starter Kit

_Техническая документация монорепозитория_

## Обзор архитектуры

Данный проект (`starter-kit`) представляет собой масштабируемый Turborepo монорепозиторий, спроектированный для разработки AI-ориентированных SaaS-продуктов. В его основе лежат строгие принципы **FSD (Feature-Sliced Design)** для фронтенда и **DDD (Domain-Driven Design)** для бэкенда.

Проект спроектирован так, чтобы быть полностью контролируемым автономными агентами (V5 Cognitive Agent Platform) и поддерживать параллельную кодогенерацию.

## Структура пакетов (Packages / Apps)

Монорепозиторий разделен на изолированные workspace-пакеты:

### Приложения (`apps/`)

- **`apps/web` (Next.js 15, Turbopack)**: Клиентская часть. Полностью следует [FSD-архитектуре](./architecture.md). Интегрирована с TailwindCSS и tRPC. Работает в окружении React 19.
- **`apps/api` (NestJS 11)**: Серверная часть. Следует архитектуре DDD. Выставляет REST и tRPC эндпоинты. Использует SWC-компилятор (`@swc/cli`, `@swc/core`) для максимизации скорости сборки.

### Пакеты (`packages/`)

- **`@core/ai-agents`**: Платформа оркестрации. Содержит Supervisor (`orchestrator_v4.ts`), рабочих агентов и Initializer Agent, которые взаимодействуют с репозиторием через MCP и AST деревья.
- **`@core/database`**: Модуль базы данных (Prisma + PostgreSQL). Отвечает за генерацию типов БД (`prisma generate`) и инстанцирование синглтона соединения с БД. Является TypeScript composite-проектом.
- **`@core/shared`**: Разделяемые типы, Zod-схемы (например, `UserSchema`, `LoginInputSchema`), константы и утилиты. Работает в строгом `NodeNext` ESM режиме, требуя явного указания расширений `.js` при экспорте/импорте.
- **`@core/trpc`**: Type-safe роутер tRPC API, объединяющий логику бэкенда и фронтенда.

## Сборка и управление зависимостями (Turborepo)

В корне расположен файл `turbo.json`, который управляет графом сборки:

1. **Топология графа**: Turborepo читает `package.json` зависимости каждого проекта для определения порядка (например, `@core/api` начнет собираться только после `@core/database` и `@core/shared`).
2. **Основные команды**:
   - `pnpm dev`: Запускает локальную разработку всего стека.
   - `pnpm build`: Соберает весь проект строго в порядке `database -> shared -> ai-agents -> api -> web`.
   - `pnpm type-check` / `pnpm lint`: Запускают проверки качества кода по всему монорепозиторию параллельно без эмиссии файлов (cacheable).

## Окружение (Environment)

1. **База данных**: Запускается локально в Docker контейнере (`docker compose up` в `packages/database`).
2. **Переменные окружения**: Управляются через корневой `.env`. Скрипты используют `dotenv-cli` (флаг `-e ../../.env`) для проброса переменных на любую глубину workspace перед запуском процессов (особенно актуально для миграций Prisma и `tsx`).

## ESM и Module Resolution

Во всем монорепозитории принудительно используется **NodeNext** Module Resolution.
Это означает:

1. В `package.json` должно стоять `"type": "module"`.
2. Абсолютно все относительные импорты в `.ts` файлах обязаны включать суффикс `.js` (например, `import { foo } from "./utils.js"`).
3. `exports` в `package.json` строго декларирует публичный API пакетов. Нарушение инкапсуляции через "глубокие" импорты (вида `@core/shared/src/schemas/user.schema.ts`) заблокировано в пользу `@core/shared/schemas`.
